(()=>{var e={};e.id=2084,e.ids=[2084],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},88037:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>h,pages:()=>d,routeModule:()=>u,tree:()=>o}),s(8975),s(9586),s(7629),s(86608);var a=s(23191),r=s(88716),n=s(37922),i=s.n(n),l=s(95231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);s.d(t,c);let o=["",{children:["mesajlar",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8975)),"C:\\Users\\mahsun\\Desktop\\hayvanpazarı.com new\\hayvanpazari\\src\\app\\mesajlar\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9586)),"C:\\Users\\mahsun\\Desktop\\hayvanpazarı.com new\\hayvanpazari\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,7629)),"C:\\Users\\mahsun\\Desktop\\hayvanpazarı.com new\\hayvanpazari\\src\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,86608)),"C:\\Users\\mahsun\\Desktop\\hayvanpazarı.com new\\hayvanpazari\\src\\app\\not-found.tsx"]}],d=["C:\\Users\\mahsun\\Desktop\\hayvanpazarı.com new\\hayvanpazari\\src\\app\\mesajlar\\page.tsx"],h="/mesajlar/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/mesajlar/page",pathname:"/mesajlar",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},78569:(e,t,s)=>{Promise.resolve().then(s.bind(s,82671))},86333:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},32933:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},69436:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},82671:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b,dynamic:()=>N});var a=s(10326),r=s(17577),n=s(77109),i=s(35047),l=s(88129),c=s(30058),o=s(77506),d=s(39730),h=s(86333);let m=(0,s(62881).Z)("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var u=s(32933),x=s(69436),p=s(15154),f=s(54176),j=s(91664),v=s(41190),g=s(3594),y=s(51223);let N="force-dynamic";function b(){(0,i.useRouter)();let{data:e,status:t}=(0,n.useSession)(),[s,N]=(0,r.useState)([]),[b,w]=(0,r.useState)(null),[_,k]=(0,r.useState)([]),[C,z]=(0,r.useState)(""),[P,E]=(0,r.useState)(!0),[M,S]=(0,r.useState)(!1),[Z,q]=(0,r.useState)(!1),R=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/messages");if(e.ok){let t=await e.json();N(t.conversations||[])}}catch(e){console.error("Error fetching conversations:",e)}finally{E(!1)}},[]),A=(0,r.useCallback)(async e=>{try{let t=await fetch(`/api/messages?userId=${e}`);if(t.ok){let e=await t.json();k(e.messages||[])}}catch(e){console.error("Error fetching messages:",e)}},[]),D=e=>{w(e),A(e),q(!0)},U=async e=>{if(e.preventDefault(),C.trim()&&b&&!M){S(!0);try{let e=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({receiverId:b,content:C})});if(e.ok){let t=await e.json();k(e=>[...e,t.message]),z(""),R()}}catch(e){console.error("Error sending message:",e)}finally{S(!1)}}},I=s.find(e=>e.other_user_id===b);return"loading"===t||P?(0,a.jsxs)("main",{className:"min-h-screen bg-earth-50/30",children:[a.jsx(p.Navbar,{}),a.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:a.jsx(o.Z,{className:"h-8 w-8 animate-spin text-nature-500"})}),a.jsx(f.Footer,{})]}):(0,a.jsxs)("main",{className:"min-h-screen bg-earth-50/30",children:[a.jsx(p.Navbar,{}),a.jsx("div",{className:"container mx-auto px-4 py-6",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-card overflow-hidden h-[calc(100vh-200px)]",children:(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:(0,y.cn)("w-full md:w-80 border-r border-earth-200 flex flex-col",Z&&"hidden md:flex"),children:[a.jsx("div",{className:"p-4 border-b border-earth-200",children:a.jsx("h1",{className:"text-xl font-bold text-earth-800",children:"Mesajlar"})}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:0===s.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[a.jsx(d.Z,{className:"h-12 w-12 text-earth-300 mb-2"}),a.jsx("p",{className:"text-earth-500",children:"Hen\xfcz mesajınız yok"}),a.jsx("p",{className:"text-sm text-earth-400 mt-1",children:"İlan sahipleriyle iletişime ge\xe7in"})]}):a.jsx("div",{className:"divide-y divide-earth-100",children:s.map(e=>(0,a.jsxs)("button",{onClick:()=>D(e.other_user_id),className:(0,y.cn)("w-full p-4 flex items-center gap-3 hover:bg-earth-50 transition-colors text-left",b===e.other_user_id&&"bg-nature-50 hover:bg-nature-50"),children:[(0,a.jsxs)(g.qE,{className:"h-12 w-12",children:[a.jsx(g.F$,{src:e.other_user_avatar||""}),a.jsx(g.Q5,{className:"bg-nature-100 text-nature-600",children:e.other_user_name.charAt(0)})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"font-medium text-earth-800 truncate",children:e.other_user_name}),e.unread_count>0&&a.jsx("span",{className:"bg-harvest-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.unread_count})]}),e.listing_title&&a.jsx("p",{className:"text-xs text-nature-600 truncate",children:e.listing_title}),a.jsx("p",{className:"text-sm text-earth-500 truncate mt-0.5",children:e.content}),a.jsx("p",{className:"text-xs text-earth-400 mt-1",children:(0,y.QN)(e.createdAt)})]})]},e.other_user_id))})})]}),a.jsx("div",{className:(0,y.cn)("flex-1 flex flex-col",!Z&&"hidden md:flex"),children:b&&I?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-4 border-b border-earth-200 flex items-center gap-3",children:[a.jsx(j.Button,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>q(!1),children:a.jsx(h.Z,{className:"h-5 w-5"})}),(0,a.jsxs)(g.qE,{className:"h-10 w-10",children:[a.jsx(g.F$,{src:I.other_user_avatar||""}),a.jsx(g.Q5,{className:"bg-nature-100 text-nature-600",children:I.other_user_name.charAt(0)})]}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"font-semibold text-earth-800",children:I.other_user_name}),I.listing_title&&a.jsx("p",{className:"text-xs text-earth-500",children:I.listing_title})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:a.jsx(l.M,{children:_.map(t=>{let s=t.senderId===e?.user?.id;return a.jsx(c.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:(0,y.cn)("flex",s?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:(0,y.cn)("max-w-[70%] px-4 py-2 rounded-2xl",s?"bg-nature-600 text-white rounded-br-none":"bg-earth-100 text-earth-800 rounded-bl-none"),children:[a.jsx("p",{children:t.content}),(0,a.jsxs)("div",{className:(0,y.cn)("flex items-center gap-1 mt-1 text-xs",s?"text-white/70":"text-earth-500"),children:[a.jsx("span",{children:new Date(t.createdAt).toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"})}),s&&(t.isRead?a.jsx(m,{className:"h-3 w-3"}):a.jsx(u.Z,{className:"h-3 w-3"}))]})]})},t.id)})})}),(0,a.jsxs)("form",{onSubmit:U,className:"p-4 border-t border-earth-200 flex gap-2",children:[a.jsx(v.I,{value:C,onChange:e=>z(e.target.value),placeholder:"Mesajınızı yazın...",className:"flex-1",disabled:M}),a.jsx(j.Button,{type:"submit",disabled:M||!C.trim(),className:"gradient-nature text-white",children:M?a.jsx(o.Z,{className:"h-4 w-4 animate-spin"}):a.jsx(x.Z,{className:"h-4 w-4"})})]})]}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-center p-8",children:[a.jsx(d.Z,{className:"h-16 w-16 text-earth-200 mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-earth-800",children:"Bir konuşma se\xe7in"}),a.jsx("p",{className:"text-earth-500 mt-1",children:"Mesajlarınızı g\xf6r\xfcnt\xfclemek i\xe7in sol taraftan bir konuşma se\xe7in"})]})})]})})}),a.jsx(f.Footer,{})]})}},8975:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,dynamic:()=>r});var a=s(68570);let r=(0,a.createProxy)(String.raw`C:\Users\mahsun\Desktop\hayvanpazarı.com new\hayvanpazari\src\app\mesajlar\page.tsx#dynamic`),n=(0,a.createProxy)(String.raw`C:\Users\mahsun\Desktop\hayvanpazarı.com new\hayvanpazari\src\app\mesajlar\page.tsx#default`)},88129:(e,t,s)=>{"use strict";s.d(t,{M:()=>j});var a=s(10326),r=s(17577),n=s(40339),i=s(74749),l=s(40295),c=s(73965);class o extends r.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d({children:e,isPresent:t}){let s=(0,r.useId)(),n=(0,r.useRef)(null),i=(0,r.useRef)({width:0,height:0,top:0,left:0}),{nonce:l}=(0,r.useContext)(c._);return(0,r.useInsertionEffect)(()=>{let{width:e,height:a,top:r,left:c}=i.current;if(t||!n.current||!e||!a)return;n.current.dataset.motionPopId=s;let o=document.createElement("style");return l&&(o.nonce=l),document.head.appendChild(o),o.sheet&&o.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${a}px !important;
            top: ${r}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(o)}},[t]),(0,a.jsx)(o,{isPresent:t,childRef:n,sizeRef:i,children:r.cloneElement(e,{ref:n})})}let h=({children:e,initial:t,isPresent:s,onExitComplete:n,custom:c,presenceAffectsLayout:o,mode:h})=>{let u=(0,i.h)(m),x=(0,r.useId)(),p=(0,r.useCallback)(e=>{for(let t of(u.set(e,!0),u.values()))if(!t)return;n&&n()},[u,n]),f=(0,r.useMemo)(()=>({id:x,initial:t,isPresent:s,custom:c,onExitComplete:p,register:e=>(u.set(e,!1),()=>u.delete(e))}),o?[Math.random(),p]:[s,p]);return(0,r.useMemo)(()=>{u.forEach((e,t)=>u.set(t,!1))},[s]),r.useEffect(()=>{s||u.size||!n||n()},[s]),"popLayout"===h&&(e=(0,a.jsx)(d,{isPresent:s,children:e})),(0,a.jsx)(l.O.Provider,{value:f,children:e})};function m(){return new Map}var u=s(56933);let x=e=>e.key||"";function p(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}var f=s(42482);let j=({children:e,custom:t,initial:s=!0,onExitComplete:l,presenceAffectsLayout:c=!0,mode:o="sync",propagate:d=!1})=>{let[m,j]=(0,u.oO)(d),v=(0,r.useMemo)(()=>p(e),[e]),g=d&&!m?[]:v.map(x),y=(0,r.useRef)(!0),N=(0,r.useRef)(v),b=(0,i.h)(()=>new Map),[w,_]=(0,r.useState)(v),[k,C]=(0,r.useState)(v);(0,f.L)(()=>{y.current=!1,N.current=v;for(let e=0;e<k.length;e++){let t=x(k[e]);g.includes(t)?b.delete(t):!0!==b.get(t)&&b.set(t,!1)}},[k,g.length,g.join("-")]);let z=[];if(v!==w){let e=[...v];for(let t=0;t<k.length;t++){let s=k[t],a=x(s);g.includes(a)||(e.splice(t,0,s),z.push(s))}"wait"===o&&z.length&&(e=z),C(p(e)),_(v);return}let{forceRender:P}=(0,r.useContext)(n.p);return(0,a.jsx)(a.Fragment,{children:k.map(e=>{let r=x(e),n=(!d||!!m)&&(v===k||g.includes(r));return(0,a.jsx)(h,{isPresent:n,initial:(!y.current||!!s)&&void 0,custom:n?void 0:t,presenceAffectsLayout:c,mode:o,onExitComplete:n?void 0:()=>{if(!b.has(r))return;b.set(r,!0);let e=!0;b.forEach(t=>{t||(e=!1)}),e&&(null==P||P(),C(N.current),d&&(null==j||j()),l&&l())},children:e},r)})})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[9276,8242,58,5626],()=>s(88037));module.exports=a})();