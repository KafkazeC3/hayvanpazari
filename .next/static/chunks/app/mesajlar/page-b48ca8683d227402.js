(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2084],{943:function(e,t,s){Promise.resolve().then(s.bind(s,9156))},2660:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(9205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},401:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(9205).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},4743:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(9205).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},9156:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y},dynamic:function(){return b}});var n=s(7437),r=s(2265),a=s(605),l=s(9376),i=s(8614),c=s(521),o=s(1817),d=s(2718),h=s(2660);let u=(0,s(9205).Z)("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var x=s(401),m=s(4743),f=s(3266),p=s(1131),j=s(2381),g=s(279),v=s(6246),N=s(3448);let b="force-dynamic";function y(){let e=(0,l.useRouter)(),{data:t,status:s}=(0,a.useSession)(),[b,y]=(0,r.useState)([]),[w,_]=(0,r.useState)(null),[k,E]=(0,r.useState)([]),[C,S]=(0,r.useState)(""),[M,Z]=(0,r.useState)(!0),[R,z]=(0,r.useState)(!1),[P,I]=(0,r.useState)(!1);(0,r.useEffect)(()=>{"unauthenticated"===s&&e.push("/giris?callbackUrl=/mesajlar")},[s,e]);let L=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/messages");if(e.ok){let t=await e.json();y(t.conversations||[])}}catch(e){console.error("Error fetching conversations:",e)}finally{Z(!1)}},[]);(0,r.useEffect)(()=>{(null==t?void 0:t.user)&&L()},[t,L]);let q=(0,r.useCallback)(async e=>{try{let t=await fetch("/api/messages?userId=".concat(e));if(t.ok){let e=await t.json();E(e.messages||[])}}catch(e){console.error("Error fetching messages:",e)}},[]),A=e=>{_(e),q(e),I(!0)},F=async e=>{if(e.preventDefault(),C.trim()&&w&&!R){z(!0);try{let e=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({receiverId:w,content:C})});if(e.ok){let t=await e.json();E(e=>[...e,t.message]),S(""),L()}}catch(e){console.error("Error sending message:",e)}finally{z(!1)}}},O=b.find(e=>e.other_user_id===w);return"loading"===s||M?(0,n.jsxs)("main",{className:"min-h-screen bg-earth-50/30",children:[(0,n.jsx)(f.Navbar,{}),(0,n.jsx)("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:(0,n.jsx)(o.Z,{className:"h-8 w-8 animate-spin text-nature-500"})}),(0,n.jsx)(p.Footer,{})]}):(0,n.jsxs)("main",{className:"min-h-screen bg-earth-50/30",children:[(0,n.jsx)(f.Navbar,{}),(0,n.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,n.jsx)("div",{className:"bg-white rounded-2xl shadow-card overflow-hidden h-[calc(100vh-200px)]",children:(0,n.jsxs)("div",{className:"flex h-full",children:[(0,n.jsxs)("div",{className:(0,N.cn)("w-full md:w-80 border-r border-earth-200 flex flex-col",P&&"hidden md:flex"),children:[(0,n.jsx)("div",{className:"p-4 border-b border-earth-200",children:(0,n.jsx)("h1",{className:"text-xl font-bold text-earth-800",children:"Mesajlar"})}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===b.length?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[(0,n.jsx)(d.Z,{className:"h-12 w-12 text-earth-300 mb-2"}),(0,n.jsx)("p",{className:"text-earth-500",children:"Hen\xfcz mesajınız yok"}),(0,n.jsx)("p",{className:"text-sm text-earth-400 mt-1",children:"İlan sahipleriyle iletişime ge\xe7in"})]}):(0,n.jsx)("div",{className:"divide-y divide-earth-100",children:b.map(e=>(0,n.jsxs)("button",{onClick:()=>A(e.other_user_id),className:(0,N.cn)("w-full p-4 flex items-center gap-3 hover:bg-earth-50 transition-colors text-left",w===e.other_user_id&&"bg-nature-50 hover:bg-nature-50"),children:[(0,n.jsxs)(v.qE,{className:"h-12 w-12",children:[(0,n.jsx)(v.F$,{src:e.other_user_avatar||""}),(0,n.jsx)(v.Q5,{className:"bg-nature-100 text-nature-600",children:e.other_user_name.charAt(0)})]}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"font-medium text-earth-800 truncate",children:e.other_user_name}),e.unread_count>0&&(0,n.jsx)("span",{className:"bg-harvest-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.unread_count})]}),e.listing_title&&(0,n.jsx)("p",{className:"text-xs text-nature-600 truncate",children:e.listing_title}),(0,n.jsx)("p",{className:"text-sm text-earth-500 truncate mt-0.5",children:e.content}),(0,n.jsx)("p",{className:"text-xs text-earth-400 mt-1",children:(0,N.QN)(e.createdAt)})]})]},e.other_user_id))})})]}),(0,n.jsx)("div",{className:(0,N.cn)("flex-1 flex flex-col",!P&&"hidden md:flex"),children:w&&O?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"p-4 border-b border-earth-200 flex items-center gap-3",children:[(0,n.jsx)(j.Button,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>I(!1),children:(0,n.jsx)(h.Z,{className:"h-5 w-5"})}),(0,n.jsxs)(v.qE,{className:"h-10 w-10",children:[(0,n.jsx)(v.F$,{src:O.other_user_avatar||""}),(0,n.jsx)(v.Q5,{className:"bg-nature-100 text-nature-600",children:O.other_user_name.charAt(0)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-earth-800",children:O.other_user_name}),O.listing_title&&(0,n.jsx)("p",{className:"text-xs text-earth-500",children:O.listing_title})]})]}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:(0,n.jsx)(i.M,{children:k.map(e=>{var s;let r=e.senderId===(null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.id);return(0,n.jsx)(c.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:(0,N.cn)("flex",r?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:(0,N.cn)("max-w-[70%] px-4 py-2 rounded-2xl",r?"bg-nature-600 text-white rounded-br-none":"bg-earth-100 text-earth-800 rounded-bl-none"),children:[(0,n.jsx)("p",{children:e.content}),(0,n.jsxs)("div",{className:(0,N.cn)("flex items-center gap-1 mt-1 text-xs",r?"text-white/70":"text-earth-500"),children:[(0,n.jsx)("span",{children:new Date(e.createdAt).toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"})}),r&&(e.isRead?(0,n.jsx)(u,{className:"h-3 w-3"}):(0,n.jsx)(x.Z,{className:"h-3 w-3"}))]})]})},e.id)})})}),(0,n.jsxs)("form",{onSubmit:F,className:"p-4 border-t border-earth-200 flex gap-2",children:[(0,n.jsx)(g.I,{value:C,onChange:e=>S(e.target.value),placeholder:"Mesajınızı yazın...",className:"flex-1",disabled:R}),(0,n.jsx)(j.Button,{type:"submit",disabled:R||!C.trim(),className:"gradient-nature text-white",children:R?(0,n.jsx)(o.Z,{className:"h-4 w-4 animate-spin"}):(0,n.jsx)(m.Z,{className:"h-4 w-4"})})]})]}):(0,n.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-center p-8",children:[(0,n.jsx)(d.Z,{className:"h-16 w-16 text-earth-200 mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-earth-800",children:"Bir konuşma se\xe7in"}),(0,n.jsx)("p",{className:"text-earth-500 mt-1",children:"Mesajlarınızı g\xf6r\xfcnt\xfclemek i\xe7in sol taraftan bir konuşma se\xe7in"})]})})]})})}),(0,n.jsx)(p.Footer,{})]})}},8614:function(e,t,s){"use strict";s.d(t,{M:function(){return j}});var n=s(7437),r=s(2265),a=s(8881),l=s(3576),i=s(4252),c=s(4664);class o extends r.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d(e){let{children:t,isPresent:s}=e,a=(0,r.useId)(),l=(0,r.useRef)(null),i=(0,r.useRef)({width:0,height:0,top:0,left:0}),{nonce:d}=(0,r.useContext)(c._);return(0,r.useInsertionEffect)(()=>{let{width:e,height:t,top:n,left:r}=i.current;if(s||!l.current||!e||!t)return;l.current.dataset.motionPopId=a;let c=document.createElement("style");return d&&(c.nonce=d),document.head.appendChild(c),c.sheet&&c.sheet.insertRule('\n          [data-motion-pop-id="'.concat(a,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(n,"px !important;\n            left: ").concat(r,"px !important;\n          }\n        ")),()=>{document.head.removeChild(c)}},[s]),(0,n.jsx)(o,{isPresent:s,childRef:l,sizeRef:i,children:r.cloneElement(t,{ref:l})})}let h=e=>{let{children:t,initial:s,isPresent:a,onExitComplete:c,custom:o,presenceAffectsLayout:h,mode:x}=e,m=(0,l.h)(u),f=(0,r.useId)(),p=(0,r.useCallback)(e=>{for(let t of(m.set(e,!0),m.values()))if(!t)return;c&&c()},[m,c]),j=(0,r.useMemo)(()=>({id:f,initial:s,isPresent:a,custom:o,onExitComplete:p,register:e=>(m.set(e,!1),()=>m.delete(e))}),h?[Math.random(),p]:[a,p]);return(0,r.useMemo)(()=>{m.forEach((e,t)=>m.set(t,!1))},[a]),r.useEffect(()=>{a||m.size||!c||c()},[a]),"popLayout"===x&&(t=(0,n.jsx)(d,{isPresent:a,children:t})),(0,n.jsx)(i.O.Provider,{value:j,children:t})};function u(){return new Map}var x=s(9637);let m=e=>e.key||"";function f(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}var p=s(1534);let j=e=>{let{children:t,custom:s,initial:i=!0,onExitComplete:c,presenceAffectsLayout:o=!0,mode:d="sync",propagate:u=!1}=e,[j,g]=(0,x.oO)(u),v=(0,r.useMemo)(()=>f(t),[t]),N=u&&!j?[]:v.map(m),b=(0,r.useRef)(!0),y=(0,r.useRef)(v),w=(0,l.h)(()=>new Map),[_,k]=(0,r.useState)(v),[E,C]=(0,r.useState)(v);(0,p.L)(()=>{b.current=!1,y.current=v;for(let e=0;e<E.length;e++){let t=m(E[e]);N.includes(t)?w.delete(t):!0!==w.get(t)&&w.set(t,!1)}},[E,N.length,N.join("-")]);let S=[];if(v!==_){let e=[...v];for(let t=0;t<E.length;t++){let s=E[t],n=m(s);N.includes(n)||(e.splice(t,0,s),S.push(s))}"wait"===d&&S.length&&(e=S),C(f(e)),k(v);return}let{forceRender:M}=(0,r.useContext)(a.p);return(0,n.jsx)(n.Fragment,{children:E.map(e=>{let t=m(e),r=(!u||!!j)&&(v===E||N.includes(t));return(0,n.jsx)(h,{isPresent:r,initial:(!b.current||!!i)&&void 0,custom:r?void 0:s,presenceAffectsLayout:o,mode:d,onExitComplete:r?void 0:()=>{if(!w.has(t))return;w.set(t,!0);let e=!0;w.forEach(t=>{t||(e=!1)}),e&&(null==M||M(),C(y.current),u&&(null==g||g()),c&&c())},children:e},t)})})}}},function(e){e.O(0,[6137,2972,2833,3290,6829,521,5518,2971,2117,1744],function(){return e(e.s=943)}),_N_E=e.O()}]);